{"version":3,"sources":["../../../src/components/Accordion/AccordionContent.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useGlobalEventListener } from '../../hooks/useGlobalEventListener';\nimport { useDOM } from '../../lib/dom';\nimport { HasRef, HasRootRef } from '../../types';\nimport { AccordionContext } from './AccordionContext';\nimport styles from './Accordion.module.css';\n\n/**\n * Функция расчета отрицательного margin, для скрытия контента.\n */\nfunction calcMarginTop(expanded: boolean, el: HTMLElement | null): string {\n  if (expanded) {\n    return `0px`;\n  }\n\n  // В первый рендеринг нельзя узнать высоту элемента, поэтому прячем таким образом\n  if (el === null) {\n    return '-100%';\n  }\n\n  return `${-el.clientHeight}px`;\n}\n\n/**\n * В первый рендеринг отключаем анимации.\n */\nfunction calcTransition(el: HTMLElement | null) {\n  return el === null ? 'none' : undefined;\n}\n\n/**\n * Хук для отслеживания изменения высоты контента.\n */\nfunction useResizeContent(expanded: boolean, inRef: React.MutableRefObject<HTMLDivElement | null>) {\n  const resize = () => {\n    inRef.current!.style.marginTop = calcMarginTop(expanded, inRef.current);\n  };\n\n  const { window } = useDOM();\n  useGlobalEventListener(window, 'resize', resize);\n}\n\n/**\n * Хук для скрывания или раскрывания контента. Возвращает стили для in элемента.\n */\nfunction useAccordionContent(\n  expanded: boolean,\n  inRef: React.MutableRefObject<HTMLDivElement | null>,\n) {\n  const marginTop = calcMarginTop(expanded, inRef.current);\n  const transition = calcTransition(inRef.current);\n\n  useResizeContent(expanded, inRef);\n\n  return { marginTop, transition };\n}\n\nexport interface AccordionContentProps\n  extends HasRootRef<HTMLDivElement>,\n    HasRef<HTMLDivElement>,\n    React.HTMLAttributes<HTMLDivElement> {}\n\nexport const AccordionContent = ({\n  getRootRef,\n  getRef,\n  className,\n  children,\n  ...restProps\n}: AccordionContentProps) => {\n  const inRef = useExternRef(getRef);\n  const { expanded, labelId, contentId } = React.useContext(AccordionContext);\n\n  const inStyle = useAccordionContent(expanded, inRef);\n\n  return (\n    <div\n      ref={getRootRef}\n      id={contentId}\n      role=\"region\"\n      aria-labelledby={labelId}\n      aria-hidden={!expanded}\n      className={classNames(styles['AccordionContent'], className)}\n      {...restProps}\n    >\n      <div ref={inRef} className={styles['AccordionContent__in']} style={inStyle}>\n        {children}\n      </div>\n    </div>\n  );\n};\n"],"names":["React","classNames","useExternRef","useGlobalEventListener","useDOM","AccordionContext","calcMarginTop","expanded","el","clientHeight","calcTransition","undefined","useResizeContent","inRef","resize","current","style","marginTop","window","useAccordionContent","transition","AccordionContent","getRootRef","getRef","className","children","restProps","labelId","contentId","useContext","inStyle","div","ref","id","role","aria-labelledby","aria-hidden"],"mappings":";;AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,UAAU,QAAQ,kBAAkB;AAC7C,SAASC,YAAY,QAAQ,2BAA2B;AACxD,SAASC,sBAAsB,QAAQ,qCAAqC;AAC5E,SAASC,MAAM,QAAQ,gBAAgB;AAEvC,SAASC,gBAAgB,QAAQ,qBAAqB;AAGtD;;CAEC,GACD,SAASC,cAAcC,QAAiB,EAAEC,EAAsB;IAC9D,IAAID,UAAU;QACZ,OAAO,CAAC,GAAG,CAAC;IACd;IAEA,iFAAiF;IACjF,IAAIC,OAAO,MAAM;QACf,OAAO;IACT;IAEA,OAAO,CAAC,EAAE,CAACA,GAAGC,YAAY,CAAC,EAAE,CAAC;AAChC;AAEA;;CAEC,GACD,SAASC,eAAeF,EAAsB;IAC5C,OAAOA,OAAO,OAAO,SAASG;AAChC;AAEA;;CAEC,GACD,SAASC,iBAAiBL,QAAiB,EAAEM,KAAoD;IAC/F,MAAMC,SAAS;QACbD,MAAME,OAAO,CAAEC,KAAK,CAACC,SAAS,GAAGX,cAAcC,UAAUM,MAAME,OAAO;IACxE;IAEA,MAAM,EAAEG,MAAM,EAAE,GAAGd;IACnBD,uBAAuBe,QAAQ,UAAUJ;AAC3C;AAEA;;CAEC,GACD,SAASK,oBACPZ,QAAiB,EACjBM,KAAoD;IAEpD,MAAMI,YAAYX,cAAcC,UAAUM,MAAME,OAAO;IACvD,MAAMK,aAAaV,eAAeG,MAAME,OAAO;IAE/CH,iBAAiBL,UAAUM;IAE3B,OAAO;QAAEI;QAAWG;IAAW;AACjC;AAOA,OAAO,MAAMC,mBAAmB;QAAC,EAC/BC,UAAU,EACVC,MAAM,EACNC,SAAS,EACTC,QAAQ,EAEc,WADnBC;QAJHJ;QACAC;QACAC;QACAC;;IAGA,MAAMZ,QAAQX,aAAaqB;IAC3B,MAAM,EAAEhB,QAAQ,EAAEoB,OAAO,EAAEC,SAAS,EAAE,GAAG5B,MAAM6B,UAAU,CAACxB;IAE1D,MAAMyB,UAAUX,oBAAoBZ,UAAUM;IAE9C,qBACE,oBAACkB;QACCC,KAAKV;QACLW,IAAIL;QACJM,MAAK;QACLC,mBAAiBR;QACjBS,eAAa,CAAC7B;QACdiB,WAAWvB,mCAAuCuB;OAC9CE,0BAEJ,oBAACK;QAAIC,KAAKnB;QAAOW,SAAS;QAAkCR,OAAOc;OAChEL;AAIT,EAAE"}